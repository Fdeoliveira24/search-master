<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Plato - search-pro/modules/related-content.js</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="../../assets/css/vendor/morris.css" rel="stylesheet" />
    <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet" />
    <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet" />
    <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet" />
    <link href="../../assets/css/plato.css" rel="stylesheet" />
    <link href="../../assets/css/plato-file.css" rel="stylesheet" />
  </head>

  <body>
    <div class="navbar navbar-fixed-top">
      <div class="container">
        <a class="navbar-brand" href="http://github.com/es-analysis/plato"
          >Plato on Github</a
        >
        <ul class="nav navbar-nav">
          <li>
            <a href="../../index.html">Report Home</a>
          </li>
        </ul>
      </div>
    </div>

    <div class="jumbotron">
      <div class="container">
        <h1>search-pro/modules/related-content.js</h1>
      </div>
    </div>

    <div class="container aggregate-stats">
      <div class="row">
        <div class="col-md-6">
          <h2 class="header">
            Maintainability
            <a
              href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"
              ><i
                class="icon icon-info-sign"
                rel="popover"
                data-placement="top"
                data-trigger="hover"
                data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability."
                data-original-title="Maintainability Index"
                data-container="body"
              ></i
            ></a>
          </h2>
          <p class="stat">62.47</p>
        </div>
        <div class="col-md-6">
          <h2 class="header">
            Lines of code
            <i
              class="icon icon-info-sign"
              rel="popover"
              data-placement="top"
              data-trigger="hover"
              data-content="Source Lines of Code / Logical Lines of Code"
              data-original-title="SLOC/LSLOC"
              data-container="body"
            ></i>
          </h2>
          <p class="stat">623</p>
        </div>
      </div>
      <div class="row historical">
        <div class="col-md-6">
          <p id="chart_historical_maint" class="chart"></p>
        </div>
        <div class="col-md-6">
          <p id="chart_historical_sloc" class="chart"></p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <h2 class="header">
            Difficulty
            <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"
              ><i
                class="icon icon-info-sign"
                rel="popover"
                data-placement="top"
                data-trigger="hover"
                data-content="The difficulty measure is related to the difficulty of the program to write or understand."
                data-original-title="Difficulty"
                data-container="body"
              ></i
            ></a>
          </h2>
          <p class="stat">62.97</p>
        </div>
        <div class="col-md-6">
          <h2 class="header">
            Estimated Errors
            <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"
              ><i
                class="icon icon-info-sign"
                rel="popover"
                data-placement="top"
                data-trigger="hover"
                data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation."
                data-original-title="Delivered Bugs"
                data-container="body"
              ></i
            ></a>
          </h2>
          <p class="stat">4.90</p>
        </div>
      </div>
    </div>

    <div class="container charts">
      <div class="row">
        <h2 class="header">Function weight</h2>
      </div>
      <div class="row">
        <div class="col-md-6">
          <h3 class="chart-header">
            By Complexity
            <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"
              ><i
                class="icon icon-info-sign"
                rel="popover"
                data-placement="top"
                data-trigger="hover"
                data-content="This metric counts the number of distinct paths through a block of code. Lower values are better."
                data-original-title="Cyclomatic Complexity"
                data-container="body"
              ></i
            ></a>
          </h3>
          <div id="fn-by-complexity" class="stat"></div>
        </div>
        <div class="col-md-6">
          <h3 class="chart-header">
            By SLOC
            <i
              class="icon icon-info-sign"
              rel="popover"
              data-placement="top"
              data-trigger="hover"
              data-content="Source Lines of Code / Logical Lines of Code"
              data-original-title="SLOC/LSLOC"
              data-container="body"
            ></i>
          </h3>
          <div id="fn-by-sloc" class="stat"></div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <textarea id="file-source" class="col-md-12">
/**
 * related-content.js - Related content module for Search Pro
 * Handles finding and displaying related search results
 */
window.SearchProModules = window.SearchProModules || {};

window.SearchProModules.RelatedContent = (function () {
  // Get dependencies
  const Utils = window.SearchProModules.Utils || {};
  const Logger = Utils.Logger || console;
  const ARIA = Utils.ARIA || {};
  const DOMHandler = window.SearchProModules.DOMHandler || {};
  const SearchEngine = window.SearchProModules.SearchEngine || {};

  // Module-specific DOM elements
  const _relatedContent = {
    container: null,
    header: null,
    toggle: null,
    itemsContainer: null,
    isExpanded: true,
    selectedItem: null,
  };

  /**
   * Calculates similarity score between two items based on configured criteria
   * @param {Object} selectedItem - The currently selected search result item
   * @param {Object} candidateItem - The item to compare for similarity
   * @param {Object} config - The configuration object
   * @returns {number} Similarity score (0-1)
   */
  function _calculateSimilarityScore(selectedItem, candidateItem, config) {
    if (!selectedItem || !candidateItem || selectedItem === candidateItem) {
      return 0;
    }

    const criteria = config.relatedContent.criteria;
    let totalScore = 0;
    let totalWeight = 0;

    // Group type similarity
    if (criteria.groupType.enabled &amp;&amp; criteria.groupType.weight &gt; 0) {
      const weight = criteria.groupType.weight;
      totalWeight += weight;

      if (selectedItem.type === candidateItem.type) {
        totalScore += weight;
      }
    }

    // Tag similarity
    if (criteria.tags.enabled &amp;&amp; criteria.tags.weight &gt; 0) {
      const weight = criteria.tags.weight;
      totalWeight += weight;

      // Calculate tag overlap
      if (
        selectedItem.tags &amp;&amp;
        candidateItem.tags &amp;&amp;
        Array.isArray(selectedItem.tags) &amp;&amp;
        Array.isArray(candidateItem.tags) &amp;&amp;
        selectedItem.tags.length &gt; 0 &amp;&amp;
        candidateItem.tags.length &gt; 0
      ) {
        const selectedTags = selectedItem.tags.map((tag) =&gt; tag.toLowerCase());
        const candidateTags = candidateItem.tags.map((tag) =&gt;
          tag.toLowerCase(),
        );

        const intersection = selectedTags.filter((tag) =&gt;
          candidateTags.includes(tag),
        );
        if (intersection.length &gt; 0) {
          const tagSimilarity =
            intersection.length /
            Math.max(selectedTags.length, candidateTags.length);
          totalScore += weight * tagSimilarity;
        }
      }
    }

    // Metadata similarity
    if (criteria.metadata.enabled &amp;&amp; criteria.metadata.weight &gt; 0) {
      const weight = criteria.metadata.weight;
      totalWeight += weight;
      totalScore +=
        weight * _calculateMetadataSimilarity(selectedItem, candidateItem);
    }

    // Normalize score based on weights
    return totalWeight &gt; 0 ? totalScore / totalWeight : 0;
  }

  /**
   * Calculates metadata similarity between two items
   * @param {Object} item1 - First item
   * @param {Object} item2 - Second item
   * @returns {number} Similarity score (0-1)
   */
  function _calculateMetadataSimilarity(item1, item2) {
    // Extract available metadata fields
    const metadata1 = item1.metadata || {};
    const metadata2 = item2.metadata || {};

    // Common fields to check (extend as needed)
    const fields = [
      &quot;description&quot;,
      &quot;author&quot;,
      &quot;category&quot;,
      &quot;creationDate&quot;,
      &quot;lastModified&quot;,
      &quot;location&quot;,
      &quot;dimensions&quot;,
      &quot;attributes&quot;,
    ];

    let matchCount = 0;
    let fieldCount = 0;

    // Compare available fields
    fields.forEach((field) =&gt; {
      if (metadata1[field] !== undefined &amp;&amp; metadata2[field] !== undefined) {
        fieldCount++;

        // Type-specific comparison
        if (
          typeof metadata1[field] === &quot;string&quot; &amp;&amp;
          typeof metadata2[field] === &quot;string&quot;
        ) {
          // String similarity (case insensitive contains)
          if (
            metadata1[field]
              .toLowerCase()
              .includes(metadata2[field].toLowerCase()) ||
            metadata2[field]
              .toLowerCase()
              .includes(metadata1[field].toLowerCase())
          ) {
            matchCount++;
          }
        } else if (
          Array.isArray(metadata1[field]) &amp;&amp;
          Array.isArray(metadata2[field])
        ) {
          // Array intersection
          const intersection = metadata1[field].filter((x) =&gt;
            metadata2[field].includes(x),
          );
          if (intersection.length &gt; 0) {
            matchCount +=
              intersection.length /
              Math.max(metadata1[field].length, metadata2[field].length);
          }
        } else if (
          typeof metadata1[field] === &quot;number&quot; &amp;&amp;
          typeof metadata2[field] === &quot;number&quot;
        ) {
          // Numeric similarity (within 10% range)
          const max = Math.max(
            Math.abs(metadata1[field]),
            Math.abs(metadata2[field]),
          );
          const diff = Math.abs(metadata1[field] - metadata2[field]);
          if (max === 0 || diff / max &lt; 0.1) {
            matchCount++;
          }
        } else if (metadata1[field] === metadata2[field]) {
          // Direct equality for other types
          matchCount++;
        }
      }
    });

    // Return normalized similarity score (0-1)
    return fieldCount &gt; 0 ? matchCount / fieldCount : 0;
  }

  /**
   * Finds items related to the selected search result
   * @param {Object} selectedItem - The currently selected search result item
   * @param {Array} allItems - All available items to find related ones from
   * @param {Object} config - The configuration object
   * @returns {Array} Sorted array of related items with similarity scores
   */
  function _findRelatedItems(selectedItem, allItems, config) {
    if (!selectedItem || !Array.isArray(allItems) || allItems.length === 0) {
      return [];
    }

    // Calculate similarity for all items
    const scoredItems = allItems
      .filter((item) =&gt; item !== selectedItem) // Exclude selected item
      .map((item) =&gt; ({
        item,
        score: _calculateSimilarityScore(selectedItem, item, config),
      }))
      .filter((result) =&gt; result.score &gt; 0) // Only keep items with some similarity
      .sort((a, b) =&gt; b.score - a.score); // Sort by similarity score (descending)

    // Limit to configured max items
    return scoredItems.slice(0, config.relatedContent.maxItems);
  }

  /**
   * Creates the related content section DOM structure
   * @param {Object} config - The configuration object
   * @returns {HTMLElement} The related content section container
   */
  function _createRelatedContentSection(config) {
    // Create section container
    const sectionContainer = document.createElement(&quot;div&quot;);
    sectionContainer.className = &quot;related-content-section&quot;;
    sectionContainer.setAttribute(
      &quot;aria-expanded&quot;,
      _relatedContent.isExpanded ? &quot;true&quot; : &quot;false&quot;,
    );

    // Create header with toggle button
    const header = document.createElement(&quot;div&quot;);
    header.className = &quot;related-header&quot;;

    // Add header text
    const headerTitle = document.createElement(&quot;h3&quot;);
    headerTitle.textContent = config.relatedContent.headerText;
    header.appendChild(headerTitle);

    // Add toggle button if collapsible
    if (config.relatedContent.collapsible) {
      const toggleBtn = document.createElement(&quot;button&quot;);
      toggleBtn.className = &quot;toggle-related&quot;;
      toggleBtn.setAttribute(
        &quot;aria-label&quot;,
        _relatedContent.isExpanded
          ? &quot;Collapse related content&quot;
          : &quot;Expand related content&quot;,
      );

      // Add toggle icon
      toggleBtn.innerHTML = `
                &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;feather&quot;&gt;
                &lt;polyline points=&quot;${_relatedContent.isExpanded ? &quot;18 15 12 9 6 15&quot; : &quot;6 9 12 15 18 9&quot;}&quot;&gt;&lt;/polyline&gt;
                &lt;/svg&gt;
            `;

      // Add click handler for toggling
      toggleBtn.addEventListener(&quot;click&quot;, () =&gt; _toggleRelatedSection(config));

      _relatedContent.toggle = toggleBtn;
      header.appendChild(toggleBtn);
    }

    // Create container for related items
    const itemsContainer = document.createElement(&quot;div&quot;);
    itemsContainer.className = &quot;related-items&quot;;
    if (!_relatedContent.isExpanded) {
      itemsContainer.style.display = &quot;none&quot;;
    }

    // Store references to DOM elements
    _relatedContent.container = sectionContainer;
    _relatedContent.header = header;
    _relatedContent.itemsContainer = itemsContainer;

    // Assemble the DOM structure
    sectionContainer.appendChild(header);
    sectionContainer.appendChild(itemsContainer);
    return sectionContainer;
  }

  /**
   * Toggles the expansion state of the related content section
   * @param {Object} config - The configuration object
   */
  function _toggleRelatedSection(config) {
    _relatedContent.isExpanded = !_relatedContent.isExpanded;

    // Update ARIA attribute
    if (_relatedContent.container) {
      _relatedContent.container.setAttribute(
        &quot;aria-expanded&quot;,
        _relatedContent.isExpanded ? &quot;true&quot; : &quot;false&quot;,
      );
    }

    // Update toggle button aria-label and icon
    if (_relatedContent.toggle) {
      _relatedContent.toggle.setAttribute(
        &quot;aria-label&quot;,
        _relatedContent.isExpanded
          ? &quot;Collapse related content&quot;
          : &quot;Expand related content&quot;,
      );

      // Update icon direction
      const icon = _relatedContent.toggle.querySelector(&quot;svg polyline&quot;);
      if (icon) {
        icon.setAttribute(
          &quot;points&quot;,
          _relatedContent.isExpanded ? &quot;18 15 12 9 6 15&quot; : &quot;6 9 12 15 18 9&quot;,
        );
      }
    }

    // Show/hide items container with animation
    if (_relatedContent.itemsContainer) {
      if (_relatedContent.isExpanded) {
        // Show with animation
        _relatedContent.itemsContainer.style.display = &quot;block&quot;;
        _relatedContent.itemsContainer.style.maxHeight = &quot;0&quot;;

        // Trigger reflow
        _relatedContent.itemsContainer.offsetHeight;

        // Start animation
        _relatedContent.itemsContainer.style.transition =
          &quot;max-height 0.3s ease-in-out&quot;;
        _relatedContent.itemsContainer.style.maxHeight =
          _relatedContent.itemsContainer.scrollHeight + &quot;px&quot;;

        // Clear max-height after animation completes
        setTimeout(() =&gt; {
          _relatedContent.itemsContainer.style.maxHeight = &quot;&quot;;
        }, 300);
      } else {
        // Hide with animation
        _relatedContent.itemsContainer.style.maxHeight =
          _relatedContent.itemsContainer.scrollHeight + &quot;px&quot;;

        // Trigger reflow
        _relatedContent.itemsContainer.offsetHeight;

        // Start animation
        _relatedContent.itemsContainer.style.transition =
          &quot;max-height 0.3s ease-in-out&quot;;
        _relatedContent.itemsContainer.style.maxHeight = &quot;0&quot;;

        // Set display:none after animation completes
        setTimeout(() =&gt; {
          _relatedContent.itemsContainer.style.display = &quot;none&quot;;
        }, 300);
      }
    }
  }

  /**
   * Updates the related content section with items related to the selected item
   * @param {Object} selectedItem - The search result that was selected
   * @param {Array} allItems - All available items to find related ones from (optional)
   * @param {Object} config - The configuration object
   * @param {Object} tour - The tour object for navigation
   */
  /**
   * Updates the related content section with items related to the selected item
   * @param {Object} selectedItem - The search result that was selected
   * @param {Array} allItems - All available items to find related ones from (optional)
   * @param {Object} config - The configuration object
   * @param {Object} tour - The tour object for navigation
   */
  function _updateRelatedContent(selectedItem, allItems, config, tour) {
    // Skip if related content is disabled
    if (!config.relatedContent || !config.relatedContent.enabled) {
      return;
    }

    // Log activity
    Logger.info(
      `Updating related content for ${selectedItem.type}: ${selectedItem.title || selectedItem.id}`,
    );

    // Store the selected item for reference
    _relatedContent.selectedItem = selectedItem;

    // Get all items if not provided
    if (!allItems &amp;&amp; typeof window.fuse !== &quot;undefined&quot; &amp;&amp; window.fuse._docs) {
      allItems = window.fuse._docs;
    }

    if (!Array.isArray(allItems) || allItems.length === 0) {
      Logger.warn(&quot;No items available to find related content&quot;);
      return;
    }

    // Find related items
    const relatedItems = _findRelatedItems(selectedItem, allItems, config);

    // Skip if no related items found
    if (relatedItems.length === 0) {
      Logger.info(&quot;No related items found for the selected item&quot;);
      // Hide related content section
      if (_relatedContent.container) {
        _relatedContent.container.style.display = &quot;none&quot;;
      }
      return;
    }

    // Create or update related content section
    let sectionContainer = _relatedContent.container;
    let itemsContainer = _relatedContent.itemsContainer;

    if (!sectionContainer) {
      // Create new section
      sectionContainer = _createRelatedContentSection(config);
      itemsContainer = _relatedContent.itemsContainer;

      // Find the results container to append related content
      const searchContainer = document.getElementById(&quot;searchContainer&quot;);
      const resultsContainer = searchContainer
        ? searchContainer.querySelector(&quot;.results-container&quot;)
        : null;

      if (resultsContainer) {
        resultsContainer.appendChild(sectionContainer);
        Logger.info(
          `Created new related content section with ${relatedItems.length} items`,
        );
      } else {
        Logger.error(
          &quot;Could not find results container to append related content&quot;,
        );
        return;
      }
    } else {
      // Show the container if hidden
      sectionContainer.style.display = &quot;&quot;;
      Logger.info(
        `Updating existing related content section with ${relatedItems.length} items`,
      );
    }

    // Clear existing related items
    if (itemsContainer) {
      itemsContainer.innerHTML = &quot;&quot;;

      // Render new related items
      relatedItems.forEach((relatedItem) =&gt; {
        const itemElement = _renderRelatedItem(relatedItem, config, tour);
        itemsContainer.appendChild(itemElement);
      });

      // Add keyboard navigation support
      _addKeyboardNavigation(sectionContainer);
    }
  }

  /**
   * Adds keyboard navigation support to the related content section
   * @param {HTMLElement} section - The related content section element
   */
  function _addKeyboardNavigation(section) {
    const items = section.querySelectorAll(&quot;.related-item&quot;);
    if (!items.length) return;

    items.forEach((item, index) =&gt; {
      // Make items focusable
      item.setAttribute(&quot;tabindex&quot;, &quot;0&quot;);

      // Add keyboard event listeners
      item.addEventListener(&quot;keydown&quot;, (e) =&gt; {
        if (e.key === &quot;Enter&quot; || e.key === &quot; &quot;) {
          // Activate item with Enter or Space
          e.preventDefault();
          item.click();
        } else if (e.key === &quot;ArrowDown&quot;) {
          // Move focus to next item
          e.preventDefault();
          const nextItem = items[index + 1] || items[0];
          nextItem.focus();
        } else if (e.key === &quot;ArrowUp&quot;) {
          // Move focus to previous item
          e.preventDefault();
          const prevItem = items[index - 1] || items[items.length - 1];
          prevItem.focus();
        }
      });
    });
  }

  /**
   * Renders a single related item
   * @param {Object} relatedItem - Item with similarity score
   * @param {Object} config - The configuration object
   * @param {Object} tour - The tour object for navigation
   * @returns {HTMLElement} The related item element
   */
  function _renderRelatedItem(relatedItem, config, tour) {
    const { item, score } = relatedItem;

    // Create item container
    const itemElement = document.createElement(&quot;div&quot;);
    itemElement.className = &quot;related-item&quot;;
    itemElement.setAttribute(&quot;tabindex&quot;, &quot;0&quot;);
    itemElement.setAttribute(&quot;data-related-score&quot;, score.toFixed(2));
    if (item.id) {
      itemElement.setAttribute(&quot;data-id&quot;, item.id);
    }
    if (item.type) {
      itemElement.setAttribute(&quot;data-type&quot;, item.type);
    }

    // Create icon based on type
    const iconElement = document.createElement(&quot;div&quot;);
    iconElement.className = &quot;related-item-icon&quot;;
    if (typeof DOMHandler.getTypeIcon === &quot;function&quot; &amp;&amp; item.type) {
      iconElement.innerHTML = DOMHandler.getTypeIcon(item.type);
    } else {
      // Default icon
      iconElement.innerHTML = `&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; class=&quot;search-result-icon&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; aria-hidden=&quot;true&quot;&gt;&lt;circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;5&quot;&gt;&lt;/circle&gt;&lt;/svg&gt;`;
    }

    // Create content container
    const contentElement = document.createElement(&quot;div&quot;);
    contentElement.className = &quot;related-item-content&quot;;

    // Add title
    const titleElement = document.createElement(&quot;div&quot;);
    titleElement.className = &quot;related-item-title&quot;;
    titleElement.textContent = item.label || &quot;Unnamed Item&quot;;
    contentElement.appendChild(titleElement);

    // Add subtitle with similarity reason
    const subtitleElement = document.createElement(&quot;div&quot;);
    subtitleElement.className = &quot;related-item-subtitle&quot;;

    // Determine relation type for subtitle
    let relationReason = &quot;&quot;;

    if (item.type === _relatedContent.selectedItem.type) {
      relationReason = `Same ${item.type} type`;
    } else if (
      item.tags &amp;&amp;
      _relatedContent.selectedItem.tags &amp;&amp;
      Array.isArray(item.tags) &amp;&amp;
      Array.isArray(_relatedContent.selectedItem.tags)
    ) {
      const commonTags = item.tags.filter((tag) =&gt;
        _relatedContent.selectedItem.tags.some(
          (selectedTag) =&gt; selectedTag.toLowerCase() === tag.toLowerCase(),
        ),
      );

      if (commonTags.length &gt; 0) {
        relationReason = `Similar tags: ${commonTags.slice(0, 2).join(&quot;, &quot;)}${commonTags.length &gt; 2 ? &quot;...&quot; : &quot;&quot;}`;
      }
    }

    if (!relationReason) {
      relationReason = `Related content (${Math.round(score * 100)}% match)`;
    }

    subtitleElement.textContent = relationReason;
    contentElement.appendChild(subtitleElement);

    // Add click handler to navigate to related item
    itemElement.addEventListener(&quot;click&quot;, () =&gt; {
      _handleRelatedItemClick(item, tour);
    });

    // Add keyboard handler for accessibility
    itemElement.addEventListener(&quot;keydown&quot;, (e) =&gt; {
      if (e.key === &quot;Enter&quot; || e.key === &quot; &quot;) {
        e.preventDefault();
        _handleRelatedItemClick(item, tour);
      }
    });

    // Assemble the item
    itemElement.appendChild(iconElement);
    itemElement.appendChild(contentElement);

    return itemElement;
  }

  /**
   * Handles click on a related item
   * @param {Object} item - The clicked item
   * @param {Object} tour - The tour object for navigation
   */
  function _handleRelatedItemClick(item, tour) {
    try {
      // Navigate to the panorama if it&#039;s a panorama type
      if (
        item.type === &quot;Panorama&quot; &amp;&amp;
        typeof item.index === &quot;number&quot; &amp;&amp;
        tour &amp;&amp;
        tour.mainPlayList
      ) {
        tour.mainPlayList.set(&quot;selectedIndex&quot;, item.index);
      }
      // For items with parent panoramas, navigate to parent first
      else if (
        typeof item.parentIndex === &quot;number&quot; &amp;&amp;
        tour &amp;&amp;
        tour.mainPlayList
      ) {
        tour.mainPlayList.set(&quot;selectedIndex&quot;, item.parentIndex);

        // Then trigger the item if it has an ID
        if (item.id) {
          setTimeout(() =&gt; {
            SearchEngine.triggerElement(tour, item.id);
          }, 100);
        }
      }
    } catch (error) {
      Logger.error(&quot;Error navigating to related item:&quot;, error);
    }
  }

  return {
    // Public API
    calculateSimilarityScore: _calculateSimilarityScore,
    calculateMetadataSimilarity: _calculateMetadataSimilarity,
    findRelatedItems: _findRelatedItems,
    createRelatedContentSection: _createRelatedContentSection,
    toggleRelatedSection: _toggleRelatedSection,
    updateRelatedContent: _updateRelatedContent,
    addKeyboardNavigation: _addKeyboardNavigation,
    renderRelatedItem: _renderRelatedItem,
    handleRelatedItemClick: _handleRelatedItemClick,
    // Export related content state
    getState: () =&gt; ({ ..._relatedContent }),
  };
})();</textarea
        >
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <p>.</p>
      </div>
    </footer>

    <script type="text/html" id="complexity-popover-template">
      <div class="complexity-notice">
        Complexity : {{ cyclomatic }} <br />
        Length : {{ halstead.length }} <br />
        Difficulty : {{ halstead.difficulty.toFixed(2) }} <br />
        Est # bugs : {{ halstead.bugs.toFixed(2) }}<br />
      </div>
    </script>

    <script
      type="text/javascript"
      src="../../assets/scripts/bundles/core-bundle.js"
    ></script>
    <script
      type="text/javascript"
      src="../../assets/scripts/bundles/codemirror.js"
    ></script>
    <script
      type="text/javascript"
      src="../../assets/scripts/codemirror.markpopovertext.js"
    ></script>
    <script type="text/javascript" src="report.js"></script>
    <script type="text/javascript" src="report.history.js"></script>
    <script
      type="text/javascript"
      src="../../assets/scripts/plato-file.js"
    ></script>
  </body>
</html>
